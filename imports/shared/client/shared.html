<template name="Shared">
  {{#contentFor "menu"}}
    {{> SharedMenu}}
  {{/contentFor}}

  {{#Layout template="InboxLayout"}}
    <div class="shared-messages">
      <div id="shared-form" class="{{#if messages.count}}hide{{/if}}">{{> MessageForm thread}}</div>

      {{#each messages}}
        {{> SharedMessage}}
      {{/each}}
      {{#if ready}}
        {{#unless messages.count}}
          <div class="todo"></div>
        {{/unless}}
        {{#if nextPath}}
          <div class="text-center"><a href="{{nextPath}}" class="text-muted small">{{_ "Load More"}}</a></div>
        {{/if}}
      {{else}}
        <div class="text-center text-muted small"><i class="fa fa-spinner fa-spin"></i></div>
      {{/if}}
    </div>
  {{/Layout}}
</template>

<template name="SharedMessage">
  <div class="message">
    {{#LinkToUser user=user}}
      {{> avatar user=user shape="circle" class="img-circle pull-left" size="small"}}
    {{/LinkToUser}}
    <div class="message-body">
      <div class="name">{{user.name}}</div>
      {{> MessageContent}}
      <div class="text-muted small">
        <a href="#" class="pull-right btn-comment text-muted"><i class="fa fa-comment-o"></i> {{_ 'Comment'}}</a>
        {{formatDayWithTime createdAt}}
      </div>
      <ul class="nav nav-pills nav-stacked comments">
        {{#each comments}}
          <li><span class="user">{{user.name}}</span>: {{content}}</li>
        {{/each}}
      </ul>
    </div>
  </div>
</template>

<template name="SharedMenuItem">
  <li class="{{#if inRouter 'shared'}}active{{/if}}">
    <a href="/shared">
      <i class="fa fa-connectdevelop"></i> <span>{{_ 'Discover'}}</span>
      {{#unless shared.read}}
        <span class="pull-right-container">
          <span class="label pull-right"><i class="fa fa-circle text-red"></i></span>
        </span>
      {{/unless}}
    </a>
  </li>
</template>

<template name="SharedMenu">
  <p class="navbar-text pull-left menu-title">
    {{#if user}}
      {{user.name}}
    {{else}}
      {{_ 'Discover'}}
    {{/if}}
  </p>
  {{#if compare user '!|' (isMe user)}}
  <div class="navbar-custom-menu">
    <ul class="nav navbar-nav">
      <li>
        <a href="#" id="btn-share" class="navbar-link menu-title">
          <i class="fa fa-camera"></i>
          <span class="hidden-xs">{{_ 'Share'}}</span>
        </a>
      </li>
    </ul>
  </div>
  {{/if}}
</template>

<template name="LinkToUserShared">
  <a href="/shared/{{user._id}}" class="{{class}}">{{> UI.contentBlock}}</a>
</template>
